name: Repo Sync Action

on:
  push:
    branches:
      - main

jobs:
  repo-sync:
    runs-on: ubuntu-latest

    steps:
      - name: Setup SSH for GitHub Access
        run: |
          mkdir -p ~/.ssh
          echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa
          ssh-keyscan github.com >> ~/.ssh/known_hosts
          chmod 644 ~/.ssh/known_hosts

      - name: Install Repo Tool
        run: |
          mkdir -p ~/bin
          curl https://storage.googleapis.com/git-repo-downloads/repo > ~/bin/repo
          chmod a+x ~/bin/repo
          echo 'export PATH=~/bin:$PATH' >> ~/.bashrc
          source ~/.bashrc

      - name: Repo Init and Sync
        run: |
          mkdir -p workspace
          cd workspace
          repo init -u git@github.com:jari-creator/manifest.git -b main -m default.xml
          repo sync
